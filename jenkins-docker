pipeline {
    agent any
    tools
    {
        maven 'maven-3'
    }
    stages {
        stage('Code Pull from SCM...') {
            steps {

                 git url: 'https://github.com/rayinianji/hello-world.git',branch: 'master'
                  }
        }
        stage('Building the code ...')
        {
            steps
            {

                sh " mvn clean package "
            }
        }
        stage('Building the Docker Image')
        {
            steps
            {
              sh 'docker build -t anjidockerid/firstmyweb:5.0.0 .' 
            }
        }

        stage('Pushing the image in to the DockerRegistry')
        {
            steps
            {
              sh "docker login -u anjidockerid -p anjibabu2#"
              sh "docker push anjidockerid/firstmyweb:5.0.0" 
            }
        }
        
        stage('Pushing the image in to the DockerRegistry')
        {
            steps{
            sshagent (credentials: ['deploy-dev'])
             {
                sh 'ssh -o StrictHostKeyChecking=no webapp/target/webapp.war ubuntu@15.206.189.200:'
            }
                }
        }
      

        }
    
}